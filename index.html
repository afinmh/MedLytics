<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedKit</title>
    <link rel="stylesheet" href="/public/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<header>
    <a href='#' class="logo">MedKit <span>.</span></a>
    <nav class="navbar">
        <a href="#openModal" id="openModalLink">About</a>
    </nav>
</header>

<!-- Body -->
<div class="container">
    <!-- Bagian Kiri (Isi Utama) -->
    <div class="main-content">
        <!-- Carousel -->
        <div class="carousel">
            <h3>Cek Keluhan di MedKit</h3>
            <p>Layanan telemedisin yang siap siaga untuk bantu kamu hidup lebih sehat</p>
            <div class="carousel-slides">
                <!-- Isi Carousel -->
                <div class="slide active">
                    <img src="public/asset/slide1.svg" alt="Deskripsi Slide 1" />
                </div>
                <div class="slide">
                    <img src="public/asset/slide2.svg" alt="Deskripsi Slide 2" />
                </div>
                <div class="slide">
                    <img src="public/asset/slide3.svg" alt="Deskripsi Slide 3" />
                </div>
            </div>
            <div class="carousel-indicators">
                <span class="dot active" onclick="goToSlide(0)"></span>
                <span class="dot" onclick="goToSlide(1)"></span>
                <span class="dot" onclick="goToSlide(2)"></span>
            </div>
            <h2 class="subtema active">Pemeriksaan Dengan AI</h2>
            <h2 class="subtema">Konsultasi Secara Online</h2>
            <h2 class="subtema">Merujuk Jurnal Kedokteran</h2>

        </div>

        <!-- Deskripsi Point-Point -->
        <div class="description">
            <h4>Mengapa MedKit?</h4>
            <div class="point">
                <img src="public/asset/qna.gif" alt="Icon Point 1">
                <p>Tanya Jawab Keluhan yang Anda Rasakan</p>
            </div>
            <div class="point">
                <img src="public/asset/robot.gif" alt="Icon Point 2">
                <p>Diagnosa Cepat dengan Teknologi AI</p>
            </div>
            <div class="point">
                <img src="public/asset/online.gif" alt="Icon Point 3">
                <p>Konsultasi Kesehatan Online 24/7</p>
            </div>
        </div>
    </div>

    <!-- Bagian Kanan (Kotak dengan Button Bulat) -->
    <div class="side-box">
        <h3 class="box-title">Cari Penyakit atau Keluhan Anda</h3>
        <p class="box-p">Pilih kategori yang tersedia sesuai kondisimu</p>
        <div class="chat-container">
            <div class="chat-header">
                <div class="assistant-info">
                    <img src="public/asset/nurse.png" alt="Barbara" class="assistant-avatar">
                    <div class="assistant-details">
                        <h4>Barbara</h4>
                        <span class="status">Online</span>
                    </div>
                </div>
                <div class="chat-controls">
                    <button id="clearChatBtn" class="chat-control-btn" title="Hapus Riwayat">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="chat-box" id="chat-box">
                <!-- Messages will be added here dynamically -->
            </div>
            <div class="input-container">
                <input type="text" id="user-input" placeholder="Ceritakan keluhanmu..." />
                <button id="send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <div class="button-grid">
            <!-- Button grid 3x3 -->
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/umumm.webp" alt="Umum" /></button>
                <span>Dokter Umum</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/batuk.webp" alt="Batuk" /></button>
                <span>Spesialis THT</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/paru.webp" alt="Flu" /></button>
                <span>Spesialis Paru</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/jantung.webp" alt="Demam" /></button>
                <span>Spesialis jantung</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/gigi.webp" alt="Batuk" /></button>
                <span>Spesialis Gigi</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/kulit.webp" alt="Flu" /></button>
                <span>Spesialis Kulit</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/gizi.webp" alt="Demam" /></button>
                <span>Spesialis Gizi</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/anak.webp" alt="Demam" /></button>
                <span>Dokter Anak</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/akal.webp" alt="Demam" /></button>
                <span>Serangan Psikis</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/depresi.webp" alt="Batuk" /></button>
                <span>Depresi</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/jiwa.webp" alt="Demam" /></button>
                <span>Gangguan jiwa</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/tugas.webp" alt="Demam" /></button>
                <span>Joki Tugas</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/hati.webp" alt="Flu" /></button>
                <span>Sakit Hati</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/mata.webp" alt="Demam" /></button>
                <span>Amaterasu</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/pusing.webp" alt="Demam" /></button>
                <span>Stress</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/pusing.webp" alt="Demam" /></button>
                <span>Coming Soon</span>
            </div>
            <div class="button-container">
                <button class="round-btn"><img src="public/asset/pusing.webp" alt="Demam" /></button>
                <span>Coming Soon</span>
            </div>
        </div>
    </div>

</div>

<!-- Footer -->
<footer class="footer">
    <div class="footer-content">
        <p>&copy; 2024 MedKit</p>
        <div class="footer-links">
            <a href="https://github.com/afinmh" target="_blank">
                <img src="public/asset/github.png" alt="GitHub" class="footer-icon">
            </a>
            <a href="https://www.halodoc.com" target="_blank">Halodoc</a>
        </div>
    </div>
</footer>


<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.dot');
    const subtema = document.querySelectorAll('.subtema');

    function showSlide(index) {
        slides.forEach((slide, i) => {
            slide.style.display = (i === index) ? 'block' : 'none';
            slide.classList.toggle('active', i === index);
        });
        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
        });
        subtema.forEach((tema, i) => {
            tema.classList.toggle('active', i === index);
        });
    }

    function goToSlide(index) {
        currentSlide = index;
        showSlide(currentSlide);
    }

    function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        showSlide(currentSlide);
    }

    // Tampilkan slide pertama saat halaman dimuat
    showSlide(currentSlide);

    // Auto-ganti slide setiap 10 detik
    setInterval(nextSlide, 10000); // 10000 ms = 10 detik

</script>

<script src="/public/js/script.js" type="module"></script>
<script>
const chatBox = document.getElementById('chat-box');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');
const clearChatBtn = document.getElementById('clearChatBtn');

// Fixed API key
const MISTRAL_API_KEY = 'QpXxoMgcaHWyIrPzkQCdYpCkIbRcJVMZ';

// System prompt for medical assistant
const systemPrompt = `You are an AI medical assistant dedicated to helping users get initial guidance regarding their health complaints and recommending consultation with appropriate doctors. Use Indonesian language in your responses. Be empathetic and informative while maintaining professionalism.`;

// Initialize chat
function initializeChat() {
    addBotMessage("Halo! Saya Suster Barbara, asisten medis virtual Anda. Ada keluhan kesehatan yang ingin Anda diskusikan atau butuh arahan awal?");
}

// Add message to chat
function addMessage(text, type) {
    const messageContainer = document.createElement('div');
    messageContainer.className = `chat-message ${type}-message`;
    
    // For bot messages, to allow HTML rendering for bold text, etc.
    if (type === 'bot') {
        // Basic sanitization (optional, but good practice if AI might produce unwanted HTML)
        // For simple cases like bold (<b> or **), this is okay.
        // If complex HTML is expected, a more robust sanitizer is needed.
        let processedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>'); // Convert markdown bold to HTML bold
        messageContainer.innerHTML = processedText;
    } else {
        messageContainer.textContent = text;
    }
    
    chatBox.appendChild(messageContainer);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function addBotMessage(text) {
    addMessage(text, 'bot');
}

function addUserMessage(text) { // Renamed for clarity, though your original 'addMessage(text, 'user')' call is fine
    addMessage(text, 'user');
}

function addSystemMessage(text) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'chat-message system-message'; // Applied system-message for styling
    messageDiv.textContent = text;
    chatBox.appendChild(messageDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// API call function
async function callMistralAPI(message) {
    try {
        const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${MISTRAL_API_KEY}`
            },
            body: JSON.stringify({
                model: "mistral-small",
                messages: [
                    { role: "system", content: systemPrompt },
                    { role: "user", content: message }
                ],
                temperature: 0.6,
                max_tokens: 800 
            })
        });

        if (!response.ok) {
            const errorData = await response.json().catch(() => null);
            console.error('API Error Response:', errorData);
            return `Maaf, terjadi kesalahan saat menghubungi server (Status: ${response.status})`;
        }

        const data = await response.json();
        if (data.choices && data.choices.length > 0 && data.choices[0].message) {
            return data.choices[0].message.content.trim();
        } else {
            console.error('Invalid API response structure:', data);
            return "Maaf, respons dari server tidak sesuai format yang diharapkan.";
        }
    } catch (error) {
        console.error('Error calling Mistral API:', error);
        return "Maaf, terjadi kesalahan dalam memproses permintaan Anda. Periksa koneksi internet Anda.";
    }
}

// Update the loading indicator
function addLoadingIndicator() {
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'chat-message bot-message typing-indicator';
    loadingDiv.innerHTML = `
        <span class="typing-dot"></span>
        <span class="typing-dot"></span>
        <span class="typing-dot"></span>
    `;
    chatBox.appendChild(loadingDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
    return loadingDiv;
}

// Send message function
async function sendMessage() {
    const messageText = userInput.value.trim();
    if (messageText) {
        addUserMessage(messageText); // Using the more specific function name
        userInput.value = '';
        userInput.focus(); // Keep focus on input
        
        const loadingIndicator = addLoadingIndicator();
        
        const responseText = await callMistralAPI(messageText);
        
        loadingIndicator.remove();
        
        addBotMessage(responseText);
    }
}

// Clear chat history function
function clearChat() {
    Swal.fire({
        title: 'Hapus Riwayat Chat?',
        text: "Semua percakapan akan dihapus dan tidak dapat dikembalikan!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#92E3A9',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Ya, Hapus!',
        cancelButtonText: 'Batal'
    }).then((result) => {
        if (result.isConfirmed) {
            chatBox.innerHTML = '';
            initializeChat();
            Swal.fire(
                'Terhapus!',
                'Riwayat chat telah dihapus.',
                'success'
            );
        }
    });
}

// Event listeners
sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
    }
});

clearChatBtn.addEventListener('click', clearChat);

// Initialize chat when page loads
initializeChat();
</script>

</body>
</html>